Res_plot <-  Res %>%
pivot_longer(
cols = c("power_EC", "power_AIPW", "power_naive"),
names_to = "Estimator",
values_to = "Type_I_Error"
)
# add single-arm case
Res_sa <- readRDS("res_sensi2/res_sa_TypeI_sensi2.RData")
Res_sa <- bind_rows(Res_sa)
Res_sa$n <- seq(6, 600, by = 1)
Res_plot_sa <-  Res_sa %>%
pivot_longer(
cols = c("power_SA"),
names_to = "Estimator",
values_to = "Type_I_Error"
)
Res_plot <- rbind(Res_plot, Res_plot_sa)
Res_plot$Estimator <- factor(Res_plot$Estimator,
levels = c(
"power_EC",
"power_AIPW",
"power_naive",
"power_SA"
))
levels(Res_plot$Estimator) <- c(
"Hybrid",
"AIPW",
"Diff-in-mean",
"Single-arm")
p_sensi2_TypeI_05 <- ggplot(data = Res_plot, aes(x = n, y = Type_I_Error, colour = Estimator)) +
geom_line(linewidth = 1) +
scale_colour_manual(values=c("#F27127FF","#FDC718FF",
"#038C33FF", "#207CF5FF"),
breaks=c("Diff-in-mean", "AIPW",
"Hybrid", "Single-arm"))+
geom_hline(yintercept = 0.05,
linetype="dashed",
color = "#084594",
linewidth = 1) +
geom_vline(xintercept= 55,
linetype="dashed",
color = "#011C40FF",
linewidth = 1)+
geom_vline(xintercept= 109,
linetype="dashed",
color =  "#005A32",
linewidth = 1)+
geom_vline(xintercept= 201,
linetype="dashed",
color = "#FEB24C",
linewidth = 1)+
theme(legend.position = "none")+
# labs(x=expression(RCT~Sample~Size~N[R]), y="Type I Error")+
labs(x=expression(Sample~Size~N[R]), y="Type I Error")+
scale_x_continuous(breaks=seq(0, 600, by=100))+
scale_y_continuous(breaks = seq(0, 0.546, by=0.1))+
expand_limits(y=c(0, 0.546))+
theme(title = element_text(size = 20),
axis.title=element_text(size = 20),
legend.title=element_text(size = 20),
axis.text=element_text(size = 20),
legend.text=element_text(size = 20))+
labs(title = expression("Non-constant"~conditional~var~","~pi[A] ==0.5))
p_sensi2_TypeI_05
}
# Type I error - 06
{
Res <- readRDS("res_sensi2/res_06_TypeI_sensi2.RData")
Res <- bind_rows(Res)
Res$n <- seq(6, 600, by = 1)
Res_plot <-  Res %>%
pivot_longer(
cols = c("power_EC", "power_AIPW", "power_naive"),
names_to = "Estimator",
values_to = "Type_I_Error"
)
# add single-arm case
Res_sa <- readRDS("res_sensi2/res_sa_TypeI_sensi2.RData")
Res_sa <- bind_rows(Res_sa)
Res_sa$n <- seq(6, 600, by = 1)
Res_plot_sa <-  Res_sa %>%
pivot_longer(
cols = c("power_SA"),
names_to = "Estimator",
values_to = "Type_I_Error"
)
Res_plot <- rbind(Res_plot, Res_plot_sa)
Res_plot$Estimator <- factor(Res_plot$Estimator,
levels = c(
"power_EC",
"power_AIPW",
"power_naive",
"power_SA"
))
levels(Res_plot$Estimator) <- c(
"Hybrid",
"AIPW",
"Diff-in-mean",
"Single-arm")
p_sensi2_TypeI_06 <- ggplot(data = Res_plot, aes(x = n, y = Type_I_Error, colour = Estimator)) +
geom_line(linewidth = 1) +
scale_colour_manual(values=c("#F27127FF","#FDC718FF",
"#038C33FF", "#207CF5FF"),
breaks=c("Diff-in-mean", "AIPW",
"Hybrid", "Single-arm"))+
geom_hline(yintercept = 0.05,
linetype="dashed",
color = "#084594",
linewidth = 1) +
geom_vline(xintercept= 55,
linetype="dashed",
color = "#011C40FF",
linewidth = 1)+
geom_vline(xintercept= 91,
linetype="dashed",
color =  "#005A32",
linewidth = 1)+
geom_vline(xintercept= 210,
linetype="dashed",
color = "#FEB24C",
linewidth = 1)+
theme(legend.position = "none")+
labs(x=expression(Sample~Size~N[R]), y="Type I Error")+
scale_x_continuous(breaks=seq(0, 600, by=100))+
scale_y_continuous(breaks = seq(0, 0.546, by=0.1))+
expand_limits(y=c(0, 0.546))+
theme(title = element_text(size = 20),
axis.title=element_text(size = 20),
legend.title=element_text(size = 20),
axis.text=element_text(size = 20),
legend.text=element_text(size = 20))+
labs(title = expression("Non-constant"~conditional~var~","~pi[A] ==0.6))
p_sensi2_TypeI_06
}
# Type I error - 07
{
Res <- readRDS("res_sensi2/res_07_TypeI_sensi2.RData")
Res <- bind_rows(Res)
Res$n <- seq(6, 600, by = 1)
Res_plot <-  Res %>%
pivot_longer(
cols = c("power_EC", "power_AIPW", "power_naive"),
names_to = "Estimator",
values_to = "Type_I_Error"
)
# add single-arm case
Res_sa <- readRDS("res_sensi2/res_sa_TypeI_sensi2.RData")
Res_sa <- bind_rows(Res_sa)
Res_sa$n <- seq(6, 600, by = 1)
Res_plot_sa <-  Res_sa %>%
pivot_longer(
cols = c("power_SA"),
names_to = "Estimator",
values_to = "Type_I_Error"
)
Res_plot <- rbind(Res_plot, Res_plot_sa)
Res_plot$Estimator <- factor(Res_plot$Estimator,
levels = c(
"power_EC",
"power_AIPW",
"power_naive",
"power_SA"
))
levels(Res_plot$Estimator) <- c(
"Hybrid",
"AIPW",
"Diff-in-mean",
"Single-arm")
p_sensi2_TypeI_07 <- ggplot(data = Res_plot, aes(x = n, y = Type_I_Error, colour = Estimator)) +
geom_line(linewidth = 1) +
scale_colour_manual(values=c("#F27127FF","#FDC718FF",
"#038C33FF", "#207CF5FF"),
breaks=c("Diff-in-mean", "AIPW",
"Hybrid", "Single-arm"))+
geom_hline(yintercept = 0.05,
linetype="dashed",
color = "#084594",
linewidth = 1) +
geom_vline(xintercept= 55,
linetype="dashed",
color = "#011C40FF",
linewidth = 1)+
geom_vline(xintercept= 78,
linetype="dashed",
color =  "#005A32",
linewidth = 1)+
geom_vline(xintercept= 240,
linetype="dashed",
color = "#FEB24C",
linewidth = 1)+
theme(legend.position = "none")+
labs(x=expression(Sample~Size~N[R]), y="Type I Error")+
scale_x_continuous(breaks=seq(0, 600, by=100))+
scale_y_continuous(breaks = seq(0, 0.546, by=0.1))+
expand_limits(y=c(0, 0.546))+
theme(title = element_text(size = 20),
axis.title=element_text(size = 20),
legend.title=element_text(size = 20),
axis.text=element_text(size = 20),
legend.text=element_text(size = 20))+
labs(title = expression("Non-constant"~conditional~var~","~pi[A] ==0.7))
p_sensi2_TypeI_07
}
# Type I error - 08
{
Res <- readRDS("res_sensi2/res_08_TypeI_sensi2.RData")
Res <- bind_rows(Res)
Res$n <- seq(6, 600, by = 1)
Res_plot <-  Res %>%
pivot_longer(
cols = c("power_EC", "power_AIPW", "power_naive"),
names_to = "Estimator",
values_to = "Type_I_Error"
)
# add single-arm case
Res_sa <- readRDS("res_sensi2/res_sa_TypeI_sensi2.RData")
Res_sa <- bind_rows(Res_sa)
Res_sa$n <- seq(6, 600, by = 1)
Res_plot_sa <-  Res_sa %>%
pivot_longer(
cols = c("power_SA"),
names_to = "Estimator",
values_to = "Type_I_Error"
)
Res_plot <- rbind(Res_plot, Res_plot_sa)
Res_plot$Estimator <- factor(Res_plot$Estimator,
levels = c(
"power_EC",
"power_AIPW",
"power_naive",
"power_SA"
))
levels(Res_plot$Estimator) <- c(
"Hybrid",
"AIPW",
"Diff-in-mean",
"Single-arm")
p_sensi2_TypeI_08 <- ggplot(data = Res_plot, aes(x = n, y = Type_I_Error, colour = Estimator)) +
geom_line(linewidth = 1) +
scale_colour_manual(values=c("#F27127FF","#FDC718FF",
"#038C33FF", "#207CF5FF"),
breaks=c("Diff-in-mean", "AIPW",
"Hybrid", "Single-arm"))+
geom_hline(yintercept = 0.05,
linetype="dashed",
color = "#084594",
linewidth = 1) +
geom_vline(xintercept= 55,
linetype="dashed",
color = "#011C40FF",
linewidth = 1)+
geom_vline(xintercept= 69,
linetype="dashed",
color =  "#005A32",
linewidth = 1)+
geom_vline(xintercept= 314,
linetype="dashed",
color = "#FEB24C",
linewidth = 1)+
theme(legend.position = "none")+
labs(x=expression(Sample~Size~N[R]), y="Type I Error")+
scale_x_continuous(breaks=seq(0, 600, by=100))+
scale_y_continuous(breaks = seq(0, 0.546, by=0.1))+
expand_limits(y=c(0, 0.546))+
theme(title = element_text(size = 20),
axis.title=element_text(size = 20),
legend.title=element_text(size = 20),
axis.text=element_text(size = 20),
legend.text=element_text(size = 20))+
labs(title = expression("Non-constant"~conditional~var~","~pi[A] ==0.8))
p_sensi2_TypeI_08
}
# Type I error - 09
{
Res <- readRDS("res_sensi2/res_09_TypeI_sensi2.RData")
Res <- bind_rows(Res)
Res$n <- seq(6, 600, by = 1)
Res_plot <-  Res %>%
pivot_longer(
cols = c("power_EC", "power_AIPW", "power_naive"),
names_to = "Estimator",
values_to = "Type_I_Error"
)
# add single-arm case
Res_sa <- readRDS("res_sensi2/res_sa_TypeI_sensi2.RData")
Res_sa <- bind_rows(Res_sa)
Res_sa$n <- seq(6, 600, by = 1)
Res_plot_sa <-  Res_sa %>%
pivot_longer(
cols = c("power_SA"),
names_to = "Estimator",
values_to = "Type_I_Error"
)
Res_plot <- rbind(Res_plot, Res_plot_sa)
Res_plot$Estimator <- factor(Res_plot$Estimator,
levels = c(
"power_EC",
"power_AIPW",
"power_naive",
"power_SA"
))
levels(Res_plot$Estimator) <- c(
"Hybrid",
"AIPW",
"Diff-in-mean",
"Single-arm")
p_sensi2_TypeI_09 <- ggplot(data = Res_plot, aes(x = n, y = Type_I_Error, colour = Estimator)) +
geom_line(linewidth = 1) +
scale_colour_manual(values=c("#F27127FF","#FDC718FF",
"#038C33FF", "#207CF5FF"),
breaks=c("Diff-in-mean", "AIPW",
"Hybrid", "Single-arm"))+
geom_hline(yintercept = 0.05,
linetype="dashed",
color = "#084594",
linewidth = 1) +
geom_vline(xintercept= 55,
linetype="dashed",
color = "#011C40FF",
linewidth = 1)+
geom_vline(xintercept= 61,
linetype="dashed",
color =  "#005A32",
linewidth = 1)+
geom_vline(xintercept= 557,
linetype="dashed",
color = "#FEB24C",
linewidth = 1)+
# theme(legend.position = "none")+
labs(x=expression(Sample~Size~N[R]), y="Type I Error")+
scale_x_continuous(breaks=seq(0, 600, by=100))+
scale_y_continuous(breaks = seq(0, 0.546, by=0.1))+
expand_limits(y=c(0, 0.546))+
theme(title = element_text(size = 20),
axis.title=element_text(size = 20),
legend.title=element_text(size = 20),
axis.text=element_text(size = 20),
legend.text=element_text(size = 20))+
labs(title = expression("Non-constant"~conditional~var~","~pi[A] ==0.9))
p_sensi2_TypeI_09
}
}
}
p_sensi1 <- ggarrange(p_sensi1_power_05, p_sensi1_power_06, p_sensi1_power_07,
p_sensi1_power_08, p_sensi1_power_09,
p_sensi1_TypeI_05, p_sensi1_TypeI_06, p_sensi1_TypeI_07,
p_sensi1_TypeI_08, p_sensi1_TypeI_09,
widths = c(1, 1, 1, 1, 1.38),
ncol = 5, nrow = 2)
p_sensi1
p_sensi1_new <- annotate_figure(p_sensi1,
bottom = text_grob("Heterogeneous treatment effect across the current study population", face = "bold", size = 22)
)
p_sensi1_new
p_sensi2 <- ggarrange(p_sensi2_power_05, p_sensi2_power_06, p_sensi2_power_07,
p_sensi2_power_08, p_sensi2_power_09,
p_sensi2_TypeI_05, p_sensi2_TypeI_06, p_sensi2_TypeI_07,
p_sensi2_TypeI_08, p_sensi2_TypeI_09,
widths = c(1, 1, 1, 1, 1.38),
ncol = 5, nrow = 2)
p_sensi2
p_sensi2_new <- annotate_figure(p_sensi2,
bottom = text_grob("Non-constant conditional variance of the outcome", face = "bold", size = 22)
)
p_sensi2_new
p_sensi <- ggarrange(p_sensi1_new,
NULL,   # this row will be pure whitespace
p_sensi2_new,
heights = c(1, 0.06, 1),
ncol = 1, nrow = 3)
p_sensi
ggsave(plot = p_sensi,
width = 37.5,
height = 24,
dpi = 1000,
filename = "/Users/jane.gao/Desktop/Hybrid experimental design/project 1/11. paper_submit/code/simulation/plots/p_sensi.pdf")
##########################################
## For supplementary material B.1
p2_power <- ggarrange(p_suff_power_05, p_suff_power_07, p_suff_power_09,
p_insuff_60_power_05, p_insuff_60_power_07, p_insuff_60_power_09,
widths = c(1, 1, 1.38),
ncol = 3, nrow = 2)
p2_power
p2_power_new <- annotate_figure(p2_power,
bottom = text_grob(expression((a)~Power~(tau==0.4)), face = "bold", size = 22)
)
p2_power_new
p2_TypeI <- ggarrange(p_suff_TypeI_05, p_suff_TypeI_07, p_suff_TypeI_09,
p_insuff_60_TypeI_05, p_insuff_60_TypeI_07, p_insuff_60_TypeI_09,
widths = c(1, 1, 1.38),
ncol = 3, nrow = 2)
p2_TypeI
p2_TypeI_new <- annotate_figure(p2_TypeI,
bottom = text_grob(expression((b)~Type~I~Error~(tau==0)), face = "bold", size = 22)
)
p2_TypeI_new
p2_supp <- ggarrange(p2_power_new,
NULL,   # this row will be pure whitespace
p2_TypeI_new,
heights = c(1, 0.06, 1),
ncol = 1, nrow = 3)
p2_supp
ggsave(plot = p2_supp,
width = 21,
height = 22,
dpi = 800,
filename = "/Users/jane.gao/Desktop/Hybrid experimental design/project 1/11. paper_submit/code/simulation/plots/p2_supp.pdf")
#
p2_supp <- ggarrange(p2_power_new,
NULL,   # this row will be pure whitespace
p2_TypeI_new,
heights = c(1, 0.06, 1),
ncol = 1, nrow = 3)
p2_supp
ggsave(plot = p2_supp,
width = 21,
height = 24,
dpi = 800,
filename = "/Users/jane.gao/Desktop/Hybrid experimental design/project 1/11. paper_submit/code/simulation/plots/p2_supp.pdf")
##########################################
## For supplementary material B.2
p_insuff_30 <- ggarrange(p_insuff_30_power_05, p_insuff_30_power_06, p_insuff_30_power_07,
p_insuff_30_power_08, p_insuff_30_power_09,
p_insuff_30_TypeI_05, p_insuff_30_TypeI_06, p_insuff_30_TypeI_07,
p_insuff_30_TypeI_08, p_insuff_30_TypeI_09,
widths = c(1, 1, 1, 1, 1.38),
ncol = 5, nrow = 2)
p_insuff_30
# ggsave(plot = p_insuff_30,
#        width = 37.5,
#        height = 12,
#        dpi = 600,
#        filename = "/Users/jane.gao/Desktop/Hybrid experimental design/11. paper_submit/code/simulation/plots/p_insuff_30.png")
ggsave(plot = p_insuff_30,
width = 37.5,
height = 14,
dpi = 800,
filename = "/Users/jane.gao/Desktop/Hybrid experimental design/project 1/11. paper_submit/code/simulation/plots/p_insuff_30.pdf")
##########################################
## For supplementary material B.2
p_insuff_30 <- ggarrange(p_insuff_30_power_05, p_insuff_30_power_06, p_insuff_30_power_07,
p_insuff_30_power_08, p_insuff_30_power_09,
p_insuff_30_TypeI_05, p_insuff_30_TypeI_06, p_insuff_30_TypeI_07,
p_insuff_30_TypeI_08, p_insuff_30_TypeI_09,
widths = c(1, 1, 1, 1, 1.38),
ncol = 5, nrow = 2)
p_insuff_30
# ggsave(plot = p_insuff_30,
#        width = 37.5,
#        height = 12,
#        dpi = 600,
#        filename = "/Users/jane.gao/Desktop/Hybrid experimental design/11. paper_submit/code/simulation/plots/p_insuff_30.png")
ggsave(plot = p_insuff_30,
width = 37.5,
height = 13.2,
dpi = 800,
filename = "/Users/jane.gao/Desktop/Hybrid experimental design/project 1/11. paper_submit/code/simulation/plots/p_insuff_30.pdf")
p_sensi <- ggarrange(p_sensi1_new,
NULL,   # this row will be pure whitespace
p_sensi2_new,
heights = c(1, 0.06, 1),
ncol = 1, nrow = 3)
p_sensi
ggsave(plot = p_sensi,
width = 37.5,
height = 26,
dpi = 1000,
filename = "/Users/jane.gao/Desktop/Hybrid experimental design/project 1/11. paper_submit/code/simulation/plots/p_sensi.pdf")
p_sensi <- ggarrange(p_sensi1_new,
NULL,   # this row will be pure whitespace
p_sensi2_new,
heights = c(1, 0.06, 1),
ncol = 1, nrow = 3)
p_sensi
ggsave(plot = p_sensi,
width = 37.5,
height = 26,
dpi = 1000,
filename = "/Users/jane.gao/Desktop/Hybrid experimental design/project 1/11. paper_submit/code/simulation/plots/p_sensi.pdf")
p_sensi1 <- ggarrange(p_sensi1_power_05, p_sensi1_power_06, p_sensi1_power_07,
p_sensi1_power_08, p_sensi1_power_09,
p_sensi1_TypeI_05, p_sensi1_TypeI_06, p_sensi1_TypeI_07,
p_sensi1_TypeI_08, p_sensi1_TypeI_09,
widths = c(1, 1, 1, 1, 1.38),
ncol = 5, nrow = 2)
p_sensi1
p_sensi1_new <- annotate_figure(p_sensi1,
bottom = text_grob("(a) Heterogeneous treatment effect across the current study population", face = "bold", size = 25)
)
p_sensi1_new
p_sensi2 <- ggarrange(p_sensi2_power_05, p_sensi2_power_06, p_sensi2_power_07,
p_sensi2_power_08, p_sensi2_power_09,
p_sensi2_TypeI_05, p_sensi2_TypeI_06, p_sensi2_TypeI_07,
p_sensi2_TypeI_08, p_sensi2_TypeI_09,
widths = c(1, 1, 1, 1, 1.38),
ncol = 5, nrow = 2)
p_sensi2
p_sensi2_new <- annotate_figure(p_sensi2,
bottom = text_grob("(b) Non-constant conditional variance of the outcome", face = "bold", size = 25)
)
p_sensi2_new
p_sensi <- ggarrange(p_sensi1_new,
NULL,   # this row will be pure whitespace
p_sensi2_new,
heights = c(1, 0.06, 1),
ncol = 1, nrow = 3)
p_sensi
ggsave(plot = p_sensi,
width = 37.5,
height = 26,
dpi = 1000,
filename = "/Users/jane.gao/Desktop/Hybrid experimental design/project 1/11. paper_submit/code/simulation/plots/p_sensi.pdf")
